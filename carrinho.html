<!DOCTYPE html>
<html lang="zxx">
<head>
	<!-- Meta Tag -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name='copyright' content=''>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Title Tag  -->
    <title>Puramoda - Seu site favorito de roupas!</title>
	<!-- Favicon -->
	<link rel="icon" type="image/png" href="images/Foto_mulher_puramoda-semfundo2.png">
	<!-- Web Font -->
	<link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
	
	<!-- StyleSheet -->
	
	<!-- Bootstrap -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Magnific Popup -->
    <link rel="stylesheet" href="css/magnific-popup.min.css">
	<!-- Font Awesome -->
    <link rel="stylesheet" href="css/font-awesome.css">
	<!-- Fancybox -->
	<link rel="stylesheet" href="css/jquery.fancybox.min.css">
	<!-- Themify Icons -->
    <link rel="stylesheet" href="css/themify-icons.css">
	<!-- Nice Select CSS -->
    <link rel="stylesheet" href="css/niceselect.css">
	<!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
	<!-- Flex Slider CSS -->
    <link rel="stylesheet" href="css/flex-slider.min.css">
	<!-- Owl Carousel -->
    <link rel="stylesheet" href="css/owl-carousel.css">
	<!-- Slicknav -->
    <link rel="stylesheet" href="css/slicknav.min.css">
	
	<!-- Eshop StyleSheet -->
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

	<!-- Cor CSS -->
	<link rel="stylesheet" href="css/color/color1.css">
	
	<link rel="stylesheet" href="#" id="colors">
	
</head>
<body class="js">
	
	<!-- Carregamento -->
	<div class="preloader">
		<div class="preloader-inner">
			<div class="preloader-icon">
				<span></span>
				<span></span>
			</div>
		</div>
	</div>
			<!-- Cabeçalho -->
			<header class="header shop v2">
				<div class="topbar">
					<div class="container">
						<div class="row">
							<div class="col-lg-4 col-md-12 col-12">
								<!-- Cima esquerda -->
								<div class="top-left">
									<ul class="list-main">
										<li><i class="ti-email"></i> puramodasac@gmail.com</li>
									</ul>
								</div>
								<!--/ Fim cima esquerda -->
							</div>
							<div class="col-lg-8 col-md-12 col-12">
								<!-- Cima direita -->
								<div class="right-content">
									<ul class="list-main">
										<li><i class="ti-location-pin"></i>Rua Antônio Fogaça de Almeida, nº 200, Jardim América, Jacareí, SP</li>
										<li><i class="ti-user"></i> <a href="/perfil">Meu perfil</a></li>
										<li><i class="ti-power-off"></i><a href="/login">Login</a></li>
									</ul>
								</div>
								<!-- Fim cima direita -->
							</div>
						</div>
					</div>
				</div>
				<div class="middle-inner">
					<div class="container">
						<div class="row">
							<div class="col-lg-2 col-md-2 col-12">
								<!-- Logo -->
								<div class="logo">
									<a href="/"><img src="images/foto_puramoda_escrito_e_mulher-removebg-preview.png" alt="logo"></a>
								</div>
								<!--/ Fim da logo -->
								<!-- Search Form -->
								<div class="search-top">
									<div class="top-search"><a href="#0"><i class="ti-search"></i></a></div>
									<!-- Pesquisar -->
									<div class="search-top">
										<form class="search-form">
											<input type="text" placeholder="Search here..." name="search">
											<button value="search" type="submit"><i class="ti-search"></i></button>
										</form>
									</div>
								</div>
								<!--/ Fim pesquisar -->
								<div class="mobile-nav"></div>
					</div>
					<div class="col-lg-8 col-md-7 col-12">
						<div class="search-bar-top">
							<img src="/images/frasepng.png">
						</div>
					</div>
					<div class="col-lg-2 col-md-3 col-12">
						<div class="right-bar">
							<!-- Search Form -->
							<div class="sinlge-bar">
								<a href="/perfil" class="single-icon"><i class="fa fa-user-circle-o" aria-hidden="true"></i></a>
							</div>
							<div class="sinlge-bar shopping">
								<a href="/carrinho" class="single-icon"><i class="ti-shopping-cart"></i></a>
								
							</div>
						</div>
					</div>
				</div>
				<!-- Header Inner -->
				<div class="header-inner">
					<div class="container">
						<div class="cat-nav-head">
							<div class="row">
								<div class="col-12">
									<div class="menu-area">
										<!-- Main Menu -->
										<nav class="navbar navbar-expand-lg">
											<div class="navbar-collapse">	
												<div class="nav-inner">	
													<ul class="nav main-menu menu navbar-nav">
														<li class="active"><a href="/">Home</a>
														</li>
														<li><a href='/produtos'>Produtos</a>
										
														</li>
														
													</ul>
												</div>
											</div>
										</nav>
										<!--/ End Main Menu -->	
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--/ End Header Inner -->
			</header>
		<!--/ End Header -->
	
	<!-- Breadcrumbs -->
	<div class="breadcrumbs">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="bread-inner">
						<ul class="bread-list">
							<li><a href='/'>Home<i class="ti-arrow-right"></i></a></li>
							<li class="active"><a href='/carrinho'>Carrinho</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- End Breadcrumbs -->
			
	<!-- Shopping Cart -->
	<div class="shopping-cart section">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<!-- Shopping Summery -->
					<table class="table shopping-summery">
						<thead>
							<tr class="main-hading">
								<th>PRODUTO</th>
								<th>NOME</th>
								<th class="text-center">PREÇO</th>
								<th class="text-center">QUANTIDADE</th>
								<th class="text-center">TOTAL</th> 
								<th class="text-center"><i class="ti-trash remove-icon"></i></th>
							</tr>
						</thead>
						<tbody id="cart-items" class="cart-items">
							<tr>
								<td colspan="6">Loading...</td>
							</tr>
						</tbody>
						</table>
					</table>
					<!--/ Fim dos pedidos -->
				</div>
			</div>
			<div class="row">
				<div class="col-12">
					<!-- Total  -->
					<div class="total-amount">
						<div class="row">
							<div class="col-lg-8 col-md-5 col-12">
								<div class="left">
								</div>
							</div>
							<div class="col-lg-4 col-md-7 col-12">
								<div class="right">
									<ul>
										<li>Total<span id="soma">R$0.00</span></li>
										<li>Frete<span>Grátis</span></li>
										<li class="last">Total<span id="total">R$0.00</span></li>
									</ul>
									<div class="button5">
										<button type="button" class="btn" id="finalizarCompra">Finalizar compra</button>	
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--/ End Total Amount -->
				</div>
			</div>
		</div>
	</div>
	<!--/ End Shopping Cart -->
			
	<!-- Start Shop Services Area  -->
	<section class="shop-services section home">
			<div class="container">
				<div class="row">
					
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Conteudo serviços loja -->
						<div class="single-service">
							<i class="ti-reload"></i>
							<h4>Reembolso grátis</h4>
							<p>Em até 30 dias</p>
						</div>
						<!-- Fim do conteudo serviços loja -->
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Conteúdo serviços loja -->
						<div class="single-service">
							<i class="ti-lock"></i>
							<h4>Pagamento seguro</h4>
							<p>Pagamento 100% seguro</p>
						</div>
						<!-- Fim do conteudo serviços loja-->
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Conteudo dos serviços da loja -->
						<div class="single-service">
							<i class="ti-tag"></i>
							<h4>Melhor preço</h4>
							<p>Preço garantido</p>
						</div>
						<!-- Fim do conteudo serviços loja -->
					</div>
				</div>
			</div>
		</section>
	<!-- End Shop Newsletter -->
	
	<!-- Start Footer Area -->
	<section class="shop-newsletter section">
		<div class="container">
			<div class="inner-top">
				<div class="row">
					<div class="col-lg-8 offset-lg-2 col-12">
				</div>
			</div>
		</div>
	</section>
	<!-- Fim do estilo do rodapé -->
		
<!--Rodapé-->
<footer class="footer">
	<!-- Cima do rodapé -->
	<div class="footer-top section">
		<div class="container">
			<div class="row">
				<div class="col-lg-5 col-md-6 col-12">
					<!--Informações da esquerda-->
					<div class="single-footer about">
						<div class="col-lg-5 col-md- col-12">
							<div class="logo">
								<a href="/"><img src="images/foto_puramoda_escrito_e_mulher-removebg-preview2.png" alt="logo"></a>
							</div>
						</div>
						<p class="text">Na PuraModa, celebramos a diversidade e o estilo da moda feminina, trazendo as últimas tendências com qualidade e sofisticação. Inspire-se com nossas peças e descubra o que há de melhor para o seu guarda-roupa.</p>
						<p class="call">Se tiver alguma dúvida, entre em contato conosco.<span><a href="tel:(12) 2128-5200">puramodasac@gmail.com</a></span></p>
					</div>
					<!-- Fim das informações esquerda -->
				</div>
				<div class="col-lg-7 col-md-6 col-12">
					<div class="single-footer social">
						<h4>Informações</h4>
					<!-- Informações direita -->
						<div class="contact">
							<ul>
								<li><i class="ti-mobile"></i> (12) 2128-5200</li>
								<li><i class="ti-email"></i> puramodasac@gmail.com</li>
								<li><i class="ti-location-pin"></i> Rua Antônio Fogaça de Almeida, nº 200, Jardim América, Jacareí, SP</li>
								<li><a href="https://www.instagram.com/puramoda_ifsp"><i class="ti-instagram"></i> Instagram</a></li>
							</ul>
						</div>
					</div>
					<!-- Fim das informações direita -->
				</div>
			</div>
		</div>
	</div>
	<!-- Fim cima rodapé -->
</footer>
		<!-- End Footer Top -->
		<div class="copyright">
			<div class="container">
				<div class="inner">
					<div class="row">
					
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- /End Footer Area -->
	
	<!-- Jquery -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<!-- Popper JS -->
	<script src="js/popper.min.js"></script>
	<!-- Bootstrap JS -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Color JS -->
	<script src="js/colors.js"></script>
	<!-- Slicknav JS -->
	<script src="js/slicknav.min.js"></script>
	<!-- Owl Carousel JS -->
	<script src="js/owl-carousel.js"></script>
	<!-- Magnific Popup JS -->
	<script src="js/magnific-popup.js"></script>
	<!-- Fancybox JS -->
	<script src="js/facnybox.min.js"></script>
	<!-- Waypoints JS -->
	<script src="js/waypoints.min.js"></script>
	<!-- Countdown JS -->
	<script src="js/finalcountdown.min.js"></script>
	<!-- Nice Select JS -->
	<script src="js/nicesellect.js"></script>
	<!-- Ytplayer JS -->
	<script src="js/ytplayer.min.js"></script>
	<!-- Flex Slider JS -->
	<script src="js/flex-slider.js"></script>
	<!-- ScrollUp JS -->
	<script src="js/scrollup.js"></script>
	<!-- Onepage Nav JS -->
	<script src="js/onepage-nav.min.js"></script>
	<!-- Easing JS -->
	<script src="js/easing.js"></script>
	<!-- Active JS -->
	<script src="js/active.js"></script>

	<script>
        // Fetch Cart Items from the API
        async function loadCartItems() {
            try {
                const response = await fetch('/api/carrinho');
                if (!response.ok) {
                    throw new Error('Failed to fetch cart items');
                }

                const cartItems = await response.json();
				let soma = 0;
        		let total = 0;

                const cartItemsContainer = document.getElementById('cart-items');
                cartItemsContainer.innerHTML = ''; // limpar mensagem de carregar

                if (cartItems.length === 0) {
                    cartItemsContainer.innerHTML = '<tr><td colspan="6">Sem items no carrinho.</td></tr>';
                    return;
                }

                cartItems.forEach(item => {
					const itemTotal = item.preco * item.quantidade;
					soma += itemTotal;

                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td class="image"><img src="${item.img}" alt="#"></td>
                        <td class="product-des">
                            <p class="product-name">${item.nome}</p>
                        </td>
                        <td class="price"><span>R$${item.preco}</span></td>
                        <td class="qty">${item.quantidade}</td>
                        <td class="total-amount"><span>R$${(item.preco * item.quantidade).toFixed(2)}</span></td>
                        <td class="action"><a href="#" class="remove-item" data-id="${item.CarrinhoItemsID}"><i class="ti-trash remove-icon"></i></a></td>
                    `;

                    cartItemsContainer.appendChild(row);
                });

				document.getElementById('soma').textContent = `R$${soma.toFixed(2)}`;
				const finalTotal = soma ;
				document.getElementById('total').textContent = `R$${finalTotal.toFixed(2)}`;

				const removeButtons = document.querySelectorAll('.remove-item');
            	removeButtons.forEach(button => {
                button.addEventListener('click', handleRemoveItem);
            });

            } catch (error) {
                console.error('Error loading cart items:', error);
                document.getElementById('cart-items').innerHTML = `
                    <tr>
                        <td colspan="6">Erro ao carregar o carrinho, tente mais tarde</td>
                    </tr>
                `;
            }
        }
		
	async function handleRemoveItem(event) {
		event.preventDefault();

		console.log("Event triggered:", event);

		const itemId = event.target.closest('a').getAttribute('data-id');
		console.log(itemId)
			
		try {
			const response = await fetch('/api/carrinho', {
				method: 'DELETE',
				headers: {
					'Content-Type': 'application/json',
			},
			body: JSON.stringify({ CarrinhoItemsID: itemId }),
			});

			if (!response.ok) {
				console.log('Failed to remove item, status:', response.status);
				throw new Error('Falha ao remover');
			}

			// reiniciar o carrinho apos remover o item
			loadCartItems();
		} catch (error) {
			console.error('Error removing item:', error);
			alert('Erro ao remover item');
		}
	}

		// carregar items
		document.addEventListener('DOMContentLoaded', loadCartItems);
    </script>

	<script>
		document.getElementById('finalizarCompra').addEventListener('click', async function(event) {
    event.preventDefault();

    try {
        const response = await fetch('/api/carrinho/clear', {
            method: 'DELETE',
        });

        if (response.ok) {
            window.location.href = '/checkout'; // Redirecionar ao checkout
        } else {
            alert('Houve um erro ao limpar o carrinho. Por favor, tente novamente.');
        }
    } catch (error) {
        console.error('Erro ao limpar o carrinho:', error);
        alert('Falha ao limpar o carrinho. Por favor, tente novamente.');
    }
});
	</script>

</body>
</html>